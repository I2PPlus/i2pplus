default:
  artifacts:
    name: "$CI_JOB_NAME"
    paths:
      - i2pinstall.exe
      - i2pupdate.zip
      - install.jar
    expire_in: 2 weeks

stages:
  - build
  - test

before_script:
  # install dependencies to build EXEs and packages
  - apt-get update -yqq
  - apt-get install -yqq libc6-i386 ant gettext
  - java -version

java 8:
  stage: build
  image: openjdk:8
  script:
    - ant pkg

java 9:
  stage: build
  image: openjdk:9
  script:
    - ant pkg

java 10:
  stage: build
  image: openjdk:10
  script:
    - ant pkg

java 11:
  stage: build
  image: openjdk:11
  script:
    - ant pkg

java 13:
  stage: build
  image: openjdk:13-buster
  script:
    - ant pkg

java 14:
  stage: build
  image: openjdk:14-buster
  # currently not well supported, needs some code fixes
  # remove this line once code is fixed
  allow_failure: true
  script:
    - ant pkg

testing:
  stage: test
  image: openjdk:8
  script:
    - apt-get install -yqq libxml2-utils findbugs
    - ./tests/scripts/checkcerts.sh
    - ./tests/scripts/checkpo.sh
    - ./tests/scripts/checkscripts.sh
    - ./tests/scripts/checkutf8.sh
    - ./tests/scripts/checkxml.sh
    - ant findbugs
  artifacts:
    expose_as: findbugs
    paths: ['findbugs.html']
    expire_in: 2 weeks
