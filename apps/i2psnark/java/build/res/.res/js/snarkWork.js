import{MESSAGE_TYPES}from"./messageTypes.js";let abortController=new AbortController;self.addEventListener("message",async event=>{if(event.data.type===MESSAGE_TYPES.FETCH_HTML_DOCUMENT)try{var response=await fetch(event.data.url,{signal:abortController.signal});if(!response.ok)throw new Error("Network error: No response from server");for(var reader=response.body.getReader(),decoder=new TextDecoder("utf-8"),chunks=[];;){var{done,value}=await reader.read();if(done)break;chunks.push(decoder.decode(value,{stream:!0}))}var content=chunks.join(""),doc=(new DOMParser).parseFromString(content,"text/html");self.postMessage({type:MESSAGE_TYPES.FETCH_HTML_DOCUMENT_RESPONSE,payload:doc})}catch(error){"AbortError"===error.name?self.postMessage({type:MESSAGE_TYPES.CANCELLED}):self.postMessage({type:MESSAGE_TYPES.ERROR,message:error.message})}else event.data.type===MESSAGE_TYPES.ABORT&&(abortController.abort(),abortController=new AbortController,self.postMessage({type:MESSAGE_TYPES.ABORTED}))});