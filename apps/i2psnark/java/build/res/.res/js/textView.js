document.addEventListener("DOMContentLoaded",function(){const doc=document,parentDoc=window.parent.document,isIframed=doc.documentElement.classList.contains("iframed")||window.parent,snarkFileNameLinks=doc.querySelectorAll(":where("+["td.fileIcon.text>a",'td.snarkFileName>a[href$=".asc"]','td.snarkFileName>a[href$=".bat"]','td.snarkFileName>a[href$=".css"]','td.snarkFileName>a[href$=".ini"]','td.snarkFileName>a[href$=".js"]','td.snarkFileName>a[href$=".json"]','td.snarkFileName>a[href$=".md5"]','td.snarkFileName>a[href$=".nfo"]','td.snarkFileName>a[href$=".sh"]','td.snarkFileName>a[href$=".srt"]','td.snarkFileName>a[href$=".txt"]','td.snarkFileName>a[href$=".url"]'].join(",")+")"),supportedFileTypes=new Set(["asc","bat","css","csv","ini","js","json","md5","nfo","txt","sh","srt","url"]),numberedFileExts=new Set(["bat","css","ini","js","sh"]),responseCache=(doc.getElementById("textview-content"),new Map),parser=new DOMParser;let viewerWrapper,viewerContent,viewerFilename;const fragment=doc.createDocumentFragment(),resetScrollPosition=(snarkFileNameLinks.forEach(link=>{var newTabSpan,newTabLink;link.closest("td.snarkFileName")&&((newTabSpan=doc.createElement("span")).className="newtab",(newTabLink=doc.createElement("a")).href=link.href,newTabLink.target="_blank",newTabLink.title="Open in new tab",newTabSpan.appendChild(newTabLink),fragment.appendChild(newTabSpan),link.parentNode.insertBefore(newTabSpan,link.nextSibling))}),{viewerWrapper,viewerContent,viewerFilename}=function(){if(!viewerWrapper)return snarkTheme=doc.getElementById("snarkTheme"),(css=doc.createElement("link")).rel="stylesheet",css.href="/i2psnark/.res/textView.css",snarkTheme.parentNode.insertBefore(css,snarkTheme),viewerWrapper=doc.createElement("div"),viewerContent=doc.createElement("div"),viewerFilename=doc.createElement("div"),viewerWrapper.id="textview",viewerWrapper.hidden=!0,viewerContent.id="textview-content",viewerFilename.id="viewerFilename",viewerContent.appendChild(viewerFilename),viewerWrapper.appendChild(viewerContent),doc.body.appendChild(viewerWrapper),{viewerWrapper:viewerWrapper,viewerContent:viewerContent,viewerFilename:viewerFilename};var snarkTheme,css}(),()=>{var txtContent=doc.getElementById("textview-content");txtContent&&""!==txtContent.innerHTML?txtContent.scrollTop=0:setTimeout(resetScrollPosition,100)});function preventScroll(selectors,prevent){(selectors="string"==typeof selectors?[selectors]:selectors).forEach(selector=>{selector=document.querySelectorAll(selector);const handleScroll=event=>{event.preventDefault()};selector.forEach(element=>{prevent?element.addEventListener("scroll",handleScroll):element.removeEventListener("scroll",handleScroll)})})}const renderContent=(fileName,fileExt,data)=>{"txt"!==fileExt&&"srt"!==fileExt&&viewerContent.classList.add("pre"),data=parser.parseFromString(data,"text/html").body.textContent||data,numberedFileExts.has(fileExt)||viewerContent.classList.contains("pre"),data=data.replace(/ /g," "),viewerContent.innerHTML=numberedFileExts.has(fileExt)?`<ol>${data.split("\n").map(line=>`<li>${line}</li>`).join("")}</ol>`:data,viewerContent.classList.toggle("lines",numberedFileExts.has(fileExt)),viewerContent.insertBefore(viewerFilename,viewerContent.firstChild),viewerWrapper.hidden=!1,requestAnimationFrame(resetScrollPosition),preventScroll("document.documentElement, document.body",!0)};snarkFileNameLinks.forEach(link=>{link.addEventListener("click",event=>{var fileName,fileExt;event.target.classList.contains("newtab")||(event.preventDefault(),(event=link.closest("tr").querySelector("td.fileIcon > a"))&&(doc.documentElement.classList.add("textviewer"),isIframed&&!parentDoc.documentElement.classList.contains("fullscreen")&&parentDoc.documentElement.classList.add("textviewer","fullscreen"),fileExt=(fileName=decodeURIComponent(event.href.split("/").pop())).substring(fileName.lastIndexOf(".")+1).toLowerCase(),supportedFileTypes.has(fileExt))&&((link,fileName,fileExt,linkHref)=>{responseCache.has(linkHref)?renderContent(0,fileExt,responseCache.get(linkHref)):(viewerFilename.innerHTML="",(link=(link=link.closest("tr").querySelector("td.fileIcon"))&&link.querySelector("img"))&&viewerFilename.prepend(link.cloneNode(!0)),fetch(linkHref).then(response=>response.text()).then(data=>{responseCache.set(linkHref,data),renderContent(0,fileExt,data)}).catch(()=>{}),(link=doc.createElement("span")).textContent=fileName,viewerFilename.appendChild(link))})(event,fileName,fileExt,event.href))})}),viewerContent.addEventListener("click",event=>event.stopPropagation()),viewerWrapper.addEventListener("click",()=>{viewerWrapper.hidden=!0,doc.documentElement.classList.remove("textviewer","fullscreen"),preventScroll("document.documentElement, document.body",!1),isIframed&&(parentDoc.documentElement.classList.remove("textviewer","fullscreen"),preventScroll("window.parent.document.documentElement, window.parent.document.body",!1))})});