import{refreshScreenLog,refreshTorrents}from"./refreshTorrents.js";let eventListenerActive=!1;const configPage=document.getElementById("mainconfig"),snarkInfo=document.getElementById("snarkInfo");document.addEventListener("DOMContentLoaded",()=>{if(!eventListenerActive&&null===configPage&&null===snarkInfo){var head,fragment,css,snarkTheme,page=document.getElementById("page")||document.querySelector(".page");const htmlTag=document.documentElement;async function handleInputClick(clickTarget){if(clickTarget.closest(clickable=".toggleview, .tab_label, .snarkNav, .filter, input[class^='action'], input.add, input.create")){const targetElement=clickTarget.matches(clickable)?clickTarget:clickTarget.closest(clickable);if(targetElement){var clickable=targetElement.matches("input[class^='action'], input[id^='action']"),isDeleteOrRemoved=targetElement.matches("input[class='actionDelete'], input[class='actionRemove']"),isFormButton=targetElement.matches("input[type=submit]"),currentForm=(targetElement.closest(".toggleview, .snarkNav, .filter"),targetElement.closest("form"));let delay=360;if(targetElement.classList.add("depress"),!isDeleteOrRemoved||(event.preventDefault(),await showConfirmationDialog(targetElement,function(targetElement){const torrent=targetElement.getAttribute("data-name");return 50<torrent.length&&(torrent=torrent.substring(0,48)+"&hellip;"),("actionRemove"===(targetElement=targetElement.className)?`<p id=msg>${removeMsg}<span class=hr></span>${removeMsg2}</p>`:`<p id=msg>${deleteMsg}</p>`).replace("{0}",`<b>${torrent}</b>`)}(targetElement),targetElement.name,targetElement.value,targetElement.dataset.action))){if(clickable){if(isDeleteOrRemoved=document.getElementById("processForm"),!(currentForm=document.getElementById("torrentlist")))return;if(!isDeleteOrRemoved)return;"processForm"===targetElement.form.target&&clickable&&(delay=4e3);const nonClickedActionButtons=currentForm.querySelectorAll("input[type=submit][class^='action']:not(.depress), input[type=submit][id^='action']:not(.depress)");nonClickedActionButtons.forEach(el=>el.classList.add("tempDisabled")),currentForm.onsubmit=async event=>{await new Promise(resolve=>setTimeout(resolve,1e3)),await refreshScreenLog(void 0,!0),await new Promise(resolve=>setTimeout(resolve,3e3)),targetElement.classList.replace("depress","inert"),nonClickedActionButtons.forEach(input=>input.classList.remove("tempDisabled"))}}else isFormButton?setTimeout(async()=>{await new Promise(resolve=>setTimeout(resolve,1e3)),await refreshScreenLog(void 0,!0),clickTarget.classList.replace("depress","inert")},delay):setTimeout(async()=>{clickTarget.classList.replace("depress","inert")},delay);setTimeout(async()=>{targetElement.classList.remove("depress"),targetElement.classList.remove("inert")},delay)}}}}async function showConfirmationDialog(targetElement,message){htmlTag.classList.add("modal");const dialog=document.createElement("div"),overlay=document.createElement("div");function captureKeyDown(event){var confirmYesButton;"Enter"===event.key?(confirmYesButton=document.querySelector("#confirmYes"))&&confirmYesButton.click():"Escape"===event.key&&(confirmYesButton=document.querySelector("#confirmNo"))&&confirmYesButton.click()}function handleResize(){var dialog=document.getElementById("confirmDialog"),dialogHeight=dialog.offsetHeight,viewportHeight=(htmlTag.classList.contains("iframed")?parent.window:window).innerHeight;let topPosition=(viewportHeight-dialogHeight)/2-(600<viewportHeight?.05*viewportHeight:0);topPosition<0?topPosition=0:topPosition+dialogHeight>viewportHeight&&(topPosition=viewportHeight-dialogHeight),dialog.style.top=topPosition+"px"}return dialog.innerHTML=message+"<p id=confirmButtons><button id=confirmNo data-action=no>Cancel</button><button id=confirmYes data-action=yes>Delete</button></p>",dialog.id="confirmDialog",overlay.id="confirmOverlay",document.body.appendChild(overlay),document.body.appendChild(dialog),requestAnimationFrame(()=>{window.scrollTo(0,0),htmlTag.classList.contains("iframed")&&parent.window.scrollTo(0,0),handleResize()}),window.addEventListener("resize",handleResize,{passive:!0}),overlay.addEventListener("click",event=>event.stopPropagation()),message=new Promise(resolve=>{let confirmed=!1;dialog.addEventListener("click",event=>{"BUTTON"===(event=event.target).tagName&&("yes"===(event=event.dataset.action)?(dialog.classList.add("postMsg"),overlay.classList.add("done"),confirmed=!0):"no"===event&&(dialog.classList.add("cancelled"),overlay.classList.add("cancelled")),document.removeEventListener("keydown",captureKeyDown),window.removeEventListener("resize",handleResize),document.getElementById("confirmDialog")?.remove(),document.getElementById("confirmOverlay")?.remove(),htmlTag.classList.remove("modal"),setTimeout(refreshTorrents,1e3),resolve(confirmed))})}),htmlTag.addEventListener("keydown",captureKeyDown),message}head=document.head,document.getElementById("modalCss"),fragment=document.createDocumentFragment(),(css=document.createElement("style")).id="modalCss",css.textContent=".modal{overflow:hidden;contain:paint}#confirmDialog:not(.cancelled):not(.postMsg){animation:slide-up .8s ease-out .2s both reverse}#confirmButtons{margin:0 -14px -20px;padding:15px;text-align:center}#confirmYes,#confirmNo{margin:4px 12px;padding:6px 8px;width:120px;font-weight:700;cursor:pointer}#confirmButtons button:hover{opacity:1}#confirmYes:active,#confirmNo:active{transform:scale(0.9)}#confirmDialog{padding:10px 15px 21px;width:480px;position:absolute;left:50%;z-index:100000;user-select:none;transform:translate(-50%,-50%)}#confirmDialog.postMsg{animation:slide-down .2s ease-in .1s both reverse,fade .1s ease 0s both}#confirmDialog.cancelled{animation:slide-down .2s ease-in .1s both reverse,fade .1s ease 0s both}#confirmOverlay{width:100%;height:100%;position:fixed;left:0;bottom:0;right:0;z-index:99999}#confirmOverlay.cancelled{animation:fade .3s ease .2s both reverse}#confirmOverlay.done{animation:fade .3s ease 0s both reverse}#msg{margin:-9px -14px 0;padding:30px 20px 30px 88px;text-align:left;font-size:110%}#msg b{max-width:384px;display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;vertical-align:bottom}#msg .hr{margin:11px 0 10px;height:0;width:100%;display:block}#msg.deleting{margin-bottom:-20px}@keyframes slide-down{0%{transform:translate(-50%, -3000px)}100%{transform:translate(-50%, -50%)}}@keyframes slide-up{0%{transform:translate(-50%, -50%)}100%{transform:translate(-50%, -500px)}}",fragment.appendChild(css),(snarkTheme=head.querySelector("#snarkTheme"))?head.insertBefore(css,snarkTheme):head.appendChild(css),fragment.textContent="",page.addEventListener("click",async event=>{eventListenerActive=!0;var clickTarget=event.target,form=document.getElementById("torrentlist");if("actionRemove"===(className=clickTarget.className)||"actionDelete"===className){event.preventDefault();let torrent=clickTarget.getAttribute("data-name");50<torrent.length&&(torrent=torrent.substring(0,48)+"&hellip;"),className="actionRemove"===className?`<p id=msg>${removeMsg}<span class=hr></span>${removeMsg2}</p>`:`<p id=msg>${deleteMsg}</p>`;var name=clickTarget.name,value=clickTarget.value,action=clickTarget.dataset.action,className=await showConfirmationDialog(0,className.replace("{0}",`<b>${torrent}</b>`));form&&className&&(action=form.querySelectorAll("input[type=hidden]:not([name=nonce]):not([name=sort])"),className=document.createElement("input"),action.forEach(input=>input.remove()),className.type="hidden",className.name=name,className.value=value,form.appendChild(className),form.requestSubmit())}else(clickTarget.matches("input.add")||clickTarget.matches("input.create"))&&(event.preventDefault(),event.stopPropagation(),clickTarget.form.requestSubmit()),handleInputClick(clickTarget);(clickTarget.classList.contains("action")||clickTarget.id.includes("action"))&&(clickTarget.setAttribute("disabled"),clickTarget.classList.add("depress")),setTimeout(()=>{refreshTorrents(refreshScreenLog)},3e3)})}});