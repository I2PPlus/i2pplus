import{initSnarkRefresh,refreshTorrents,refreshScreenLog}from"./refreshTorrents.js";const elements={addNotify:document.getElementById("addNotify"),addTorrent:document.getElementById("addForm"),createNotify:document.getElementById("createNotify"),createTorrent:document.getElementById("createForm"),inputAddFile:document.getElementById("addTorrentURL"),inputNewFile:document.getElementById("createTorrentFile"),processForm:document.getElementById("processForm")};let hideAlertTimeoutId,lastMessage="";async function handleTorrentNotify(event,notificationElement,inputElement,form){if(event.preventDefault(),elements.addNotify||elements.createNotify)try{await submitForm(form),await new Promise(resolve=>setTimeout(resolve,1500)),await refreshScreenLog(()=>{requestAnimationFrame(()=>{showNotification(notificationElement,inputElement,getLastMessage())})},!0)}catch(error){}}function showNotification(notificationElement,inputElement,displayText){hideAlertTimeoutId&&clearTimeout(hideAlertTimeoutId),notificationElement.querySelector("td").innerHTML=displayText,notificationElement.removeAttribute("hidden"),hideAlertTimeoutId=setTimeout(()=>{hideAlert(notificationElement),inputElement.value="",inputElement.focus()},6e3)}function hideAlert(notificationElement){notificationElement&&requestAnimationFrame(()=>{notificationElement.setAttribute("hidden","")})}async function submitForm(form){try{var formData=new FormData(form),action=form.getAttribute("action"),response=await fetch(action,{method:form.method,body:formData});if(!response.ok)throw new Error("Form submission failed with status "+response.status)}catch(error){}}function getLastMessage(){var messageText=document.getElementById("messages").querySelector("li.msg").innerHTML.trim(),index=messageText.indexOf("&nbsp; ");return lastMessage=-1!==index?messageText.substring(index+7):messageText}function initSnarkAlert(){document.addEventListener("DOMContentLoaded",()=>{elements.addNotify&&[elements.addTorrent,elements.createTorrent].forEach(form=>{form&&(form.removeEventListener("submit",handleTorrentNotify),form.addEventListener("submit",event=>{handleTorrentNotify(event,form===elements.addTorrent?elements.addNotify:elements.createNotify,form===elements.addTorrent?elements.inputAddFile:elements.inputNewFile,form)}))})})}initSnarkAlert();export{initSnarkAlert};