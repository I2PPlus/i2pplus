const snarkFiles=document.getElementById("snarkFiles");class Lightbox{constructor(){snarkFiles&&(this.prefix="lb",this.data_attr="data-"+this.prefix,this.body=document.body,this.parentDoc=window.parent.document,this.currGroup=this.currThumb=null,this.currImages=[],this.isOpen=!1,this.currImage={},this.opt={},this.intervalId=null,this.slideshowDelay=5e3,this.initialize())}initialize(){this.box=this.createEl("div",this.prefix),this.body.appendChild(this.box),this.addEventListeners()}createEl(tag,id){return(tag=document.createElement(tag)).id=id,tag}createButton(text,id,callback){return(id=this.createEl("span",id)).textContent=text,id.addEventListener("click",e=>{e.stopPropagation(),callback()}),id}createControls(){const container=this.createEl("div",this.prefix+"-playpause");return[{text:"<",id:this.prefix+"-prev",action:this.prev.bind(this)},{text:">",id:this.prefix+"-next",action:this.next.bind(this)},{text:"Play",id:this.prefix+"-play",action:this.play.bind(this)},{text:"Pause",id:this.prefix+"-pause",action:this.pause.bind(this)}].forEach(({text,id,action})=>{text=this.createButton(text,id,action),(id===this.prefix+"-prev"||id===this.prefix+"-next"?this.box:container).appendChild(text),id===this.prefix+"-prev"&&(this.prevBtn=text),id===this.prefix+"-next"&&(this.nextBtn=text),id===this.prefix+"-play"&&(this.playBtn=text),id===this.prefix+"-pause"&&(this.pauseBtn=text)}),this.box.appendChild(container),container}load(opt={}){this.setOpt(opt),this.thumbnails=[...document.querySelectorAll(".thumb")],this.thumbnails.forEach((thumbnail,index)=>{thumbnail.setAttribute(this.data_attr+"-index",index),this.addThumbnailClickHandler(thumbnail)}),1<this.thumbnails.length&&(this.playPauseContainer=this.createControls())}setOpt(opt){this.opt={preload:!0,maxImgSize:.75,...opt},this.box.addEventListener("click",this.close.bind(this))}addThumbnailClickHandler(thumbnail){thumbnail.addEventListener("click",e=>{e.preventDefault(),this.currGroup=thumbnail.getAttribute(this.data_attr+"-group")||"",this.currThumb=thumbnail,this.openBox(thumbnail)})}openBox(el){el&&(document.body.classList.add("lightbox"),window.scrollTo(0,0),this.currImage.img=new Image,el=el.getAttribute(this.data_attr)||el.src,this.currImage.img.src=el,this.box.style.display="flex",this.currImages=Array.from(document.querySelectorAll(`[${this.data_attr}-group="${this.currGroup}"]`)),this.currImage.img.onload=()=>this.onImageLoad(),this.box.appendChild(this.currImage.img),this.adjustPosition(),this.setupResizeObserver())}onImageLoad(){this.isOpen=!0,this.resize(),this.box.classList.add("active"),1<this.currImages.length&&this.toggleControlButtons(),this.repositionControls()}toggleControlButtons(){this.prevBtn&&this.prevBtn.classList.add("active"),this.nextBtn&&this.nextBtn.classList.add("active"),this.preload(),this.playBtn&&this.playBtn.classList.toggle("active",!this.intervalId),this.pauseBtn&&this.pauseBtn.classList.toggle("active",!!this.intervalId)}preload(){var nextThumb,currIndex;this.currGroup&&(currIndex=this.thumbnails.findIndex(thumb=>thumb===this.currThumb),nextThumb=this.thumbnails[(currIndex+1)%this.thumbnails.length],currIndex=this.thumbnails[(currIndex-1+this.thumbnails.length)%this.thumbnails.length],(new Image).src=nextThumb.getAttribute(this.data_attr)||nextThumb.src,(new Image).src=currIndex.getAttribute(this.data_attr)||currIndex.src)}resize(){if(this.currImage.img){var maxWidth=window.innerWidth*this.opt.maxImgSize,maxHeight=window.innerHeight*this.opt.maxImgSize;let newImgHeight=maxWidth/(this.currImage.img.naturalWidth/this.currImage.img.naturalHeight);newImgHeight>maxHeight&&(newImgHeight=maxHeight),Object.assign(this.currImage.img.style,{height:newImgHeight+"px",maxWidth:maxWidth+"px",maxHeight:maxHeight+"px"})}}close(){this.isOpen=!1,this.body.classList.remove("lightbox"),this.box.classList.remove("active"),this.currImage.img.remove(),this.resetParentStyles(),this.cleanupObserversAndListeners(),this.pause()}adjustPosition(){this.isIframed()?(this.parentDoc.body.style.overflow="hidden",this.parentDoc.body.style.contain="paint",this.parentDoc.documentElement.style.overflow="hidden",this.parentDoc.documentElement.classList.add("lightbox","fullscreen"),this.box.style.height=window.parent.innerHeight+"px"):this.box.style.height="100vh",window.scrollTo(0,0)}resetParentStyles(){this.isIframed()&&(this.parentDoc.documentElement.classList.remove("lightbox","fullscreen"),this.parentDoc.body.removeAttribute("style"),this.parentDoc.documentElement.removeAttribute("style"))}cleanupObserversAndListeners(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}play(){this.intervalId||(this.intervalId=setInterval(()=>this.next(),this.slideshowDelay),this.togglePlayPauseButtons(),this.body.classList.add("slideshow"))}pause(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),this.togglePlayPauseButtons(!0),this.body.classList.remove("slideshow")}togglePlayPauseButtons(isPaused=!1){this.playBtn&&this.playBtn.classList.toggle("active",isPaused),this.pauseBtn&&this.pauseBtn.classList.toggle("active",!isPaused),this.prevBtn&&this.prevBtn.classList.toggle("active",!isPaused),this.nextBtn&&this.nextBtn.classList.toggle("active",!isPaused)}addEventListeners(){this.addResizeEventListener()}addResizeEventListener(){window.addEventListener("resize",()=>{this.isOpen&&(this.resize(),this.repositionControls())},{passive:!0})}next(){var pos;this.currGroup&&(this.currImage.img.remove(),pos=this.currImages.findIndex(thumbnail=>thumbnail===this.currThumb)+1,this.currImages[pos]?this.currThumb=this.currImages[pos]:this.currThumb=this.currImages[0],this.openBox(this.currThumb))}prev(){var pos;this.currGroup&&(this.currImage.img.remove(),pos=this.currImages.findIndex(thumbnail=>thumbnail===this.currThumb)-1,this.currImages[pos]?this.currThumb=this.currImages[pos]:this.currThumb=this.currImages[this.currImages.length-1],this.openBox(this.currThumb))}isIframed(){return document.documentElement.classList.contains("iframed")||window.top!==window.self}setupResizeObserver(){this.resizeObserver=new ResizeObserver(entries=>{entries.forEach(entry=>{entry.target===(this.isIframed()?this.parentDoc:document).body&&this.isOpen&&(this.resize(),this.repositionControls())})}),this.resizeObserver.observe((this.isIframed()?this.parentDoc:document).body)}repositionControls(){if(this.prevBtn&&this.nextBtn){const btnTop=(this.isIframed()?window.parent:window).innerHeight/2-this.prevBtn.offsetHeight/2;[this.prevBtn,this.nextBtn].forEach(btn=>{btn.style.top=btnTop+"px"})}}}export{Lightbox};