import{refreshElements}from"./refreshElements.js";!function(){document.getElementById("banlist");const banBody=document.getElementById("sessionBanlist"),ff=(document.getElementById("sessionBanlistFooter"),document.getElementById("floodfills")),ffprofiles=document.getElementById("ffProfiles"),info=document.getElementById("profiles_overview"),pbody=(document.getElementById("profiles"),document.getElementById("pbody")),plist=document.getElementById("profilelist"),thresholds=document.getElementById("thresholds"),sessionBans=document.getElementById("sessionBanned"),uri=""!==window.location.search.substring(1)?window.location.pathname+"?"+window.location.search.substring(1):window.location.pathname;let sorterFF=null,sorterP=null,sorterBans=null;function addSortListeners(){ff&&null===sorterFF?(sorterFF=new Tablesort(ff,{descending:!0}),ff.addEventListener("beforeSort",()=>progressx.show(theme)),ff.addEventListener("afterSort",()=>progressx.hide())):plist&&null===sorterP?(sorterP=new Tablesort(plist,{descending:!0}),plist.addEventListener("beforeSort",()=>progressx.show(theme)),plist.addEventListener("afterSort",()=>progressx.hide())):sessionBans&&null===sorterBans&&(sorterBans=new Tablesort(sessionBans,{descending:!1}),sessionBans.addEventListener("beforeSort",()=>progressx.show(theme)),sessionBans.addEventListener("afterSort",()=>progressx.hide()))}function updateBanSummary(banBody){banBody=banBody.querySelectorAll("tr");const reasonCounts={};var total=banBody.length,banBody=(banBody.forEach(row=>{if(row=row.querySelector("td:first-child")){let reason=row.textContent;(reason=(reason=(reason=reason.split("(")[0].trim()).replace("Compressible RouterInfo & older than 0.9.57","Invalid RouterInfo").replace("<b> -&gt; </b>","").replace("<b> -> </b>","").replace(/-&gt;\s*/,"").replace(/->\s*/,"")).trim())&&(reasonCounts[reason]=(reasonCounts[reason]||0)+1)}}),Object.entries(reasonCounts).sort((a,b)=>b[1]!==a[1]?b[1]-a[1]:a[0].localeCompare(b[0])));let summaryDiv=document.getElementById("banSummary"),html=`<h2>Total Session Bans: ${total}</h2>
<ul>`;banBody.forEach(([reason,count])=>{html+=`<li><span class=badge>${count}</span> ${reason}</li>
`}),html+="</ul>",summaryDiv||((summaryDiv=document.createElement("div")).id="banSummary",summaryDiv.style.marginBottom="15px",summaryDiv.style.padding="10px",sessionBans&&sessionBans.parentNode&&sessionBans.parentNode.insertBefore(summaryDiv,sessionBans)),summaryDiv.innerHTML=html,(total=document.getElementById("sessionBanlistFooter"))&&total.remove()}document.addEventListener("DOMContentLoaded",()=>{var targetSelectors;addSortListeners(),(info||thresholds)&&(targetSelectors=[info,thresholds].filter(el=>el).map(el=>"#"+el.id).join(", "),refreshElements(targetSelectors,uri,5e3)),plist&&(targetSelectors=pbody?"#pbody":"#profilelist",refreshElements(targetSelectors,uri,15e3)),ff&&(targetSelectors=ffprofiles?"#ffProfiles":"#floodfills",refreshElements(targetSelectors,uri,15e3)),sessionBans&&refreshElements("#sessionBanlist tr",uri,15e3),document.addEventListener("refreshComplete",()=>{addSortListeners(),sorterP&&sorterP.refresh(),sorterFF&&sorterFF.refresh(),sorterBans&&sorterBans.refresh(),banBody&&updateBanSummary(banBody)}),banBody&&updateBanSummary(banBody)})}();