!function(undefined){var count,logEnabled,hiddenCheckEnabled,msgHeaderLen,msgId,msgIdLen,pagePosition,requestAnimationFrame,resetRequiredMethods,settings,timer,defaults,frameTimer;function getMutationObserver(){return window.MutationObserver}function addEventListener(el,evt,func){el.addEventListener(evt,func,!1)}function removeEventListener(el,evt,func){el.removeEventListener(evt,func,!1)}function isLogEnabled(iframeId){return settings[iframeId]?settings[iframeId].log:logEnabled}function log(iframeId,msg){output("log",iframeId,msg,isLogEnabled(iframeId))}function warn(iframeId,msg){output("warn",iframeId,msg,!0)}function output(type,iframeId,msg,enabled){!0===enabled&&"object"==typeof window.console&&console[type](function(iframeId){return msgId+"["+function(iframeId){var retStr="Host page: "+iframeId;return window.top!==window.self?window.parentIFrame&&window.parentIFrame.getId?window.parentIFrame.getId()+": "+iframeId:"Nested host page: "+iframeId:retStr}(iframeId)+"]"}(iframeId),msg)}function iFrameListener(event){function resizeIFrame(){ensureInRange("Height"),ensureInRange("Width"),syncResize(function(){setSize(messageData),setPagePosition(iframeId),on("onResized",messageData)},messageData,"init")}function ensureInRange(Dimension){var max=Number(settings[iframeId]["max"+Dimension]),min=Number(settings[iframeId]["min"+Dimension]),Dimension=Dimension.toLowerCase(),size=Number(messageData[Dimension]);log(iframeId,"Checking "+Dimension+" is in range "+min+"-"+max),size<min&&(size=min,log(iframeId,"Set "+Dimension+" to min value")),max<size&&(size=max,log(iframeId,"Set "+Dimension+" to max value")),messageData[Dimension]=""+size}function getMsgBody(offset){return msg.substr(msg.indexOf(":")+msgHeaderLen+offset)}function sendPageInfoToIframe(iframe,iframeId){var frameId;frameTimer[frameId=iframeId]||(frameTimer[frameId]=setTimeout(function(){var bodyPosition,iFramePosition;frameTimer[frameId]=null,trigger("Send Page Info","pageInfo:"+(bodyPosition=document.body.getBoundingClientRect(),iFramePosition=messageData.iframe.getBoundingClientRect(),JSON.stringify({iframeHeight:iFramePosition.height,iframeWidth:iFramePosition.width,clientHeight:Math.max(document.documentElement.clientHeight,window.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,window.innerWidth||0),offsetTop:parseInt(iFramePosition.top-bodyPosition.top,10),offsetLeft:parseInt(iFramePosition.left-bodyPosition.left,10),scrollTop:window.pageYOffset,scrollLeft:window.pageXOffset,documentHeight:document.documentElement.clientHeight,documentWidth:document.documentElement.clientWidth,windowHeight:window.innerHeight,windowWidth:window.innerWidth})),iframe,iframeId)},32))}function getElementPosition(target){return target=target.getBoundingClientRect(),getPagePosition(iframeId),{x:Math.floor(Number(target.left)+Number(pagePosition.x)),y:Math.floor(Number(target.top)+Number(pagePosition.y))}}function scrollRequestFromChild(addOffset){var offset=addOffset?getElementPosition(messageData.iframe):{x:0,y:0},newPosition={x:Number(messageData.width)+offset.x,y:Number(messageData.height)+offset.y};log(iframeId,"Reposition requested from iFrame (offset x:"+offset.x+" y:"+offset.y+")"),window.top!==window.self?window.parentIFrame?window.parentIFrame["scrollTo"+(addOffset?"Offset":"")](newPosition.x,newPosition.y):warn(iframeId,"Unable to scroll to requested position, window.parentIFrame not found"):(pagePosition=newPosition,scrollTo(),log(iframeId,"--"))}function scrollTo(){!1!==on("onScroll",pagePosition)?setPagePosition(iframeId):unsetPagePosition()}function onMouse(event){var data=0===Number(messageData.width)&&0===Number(messageData.height)?{x:(data=getMsgBody(9).split(":"))[1],y:data[0]}:{x:messageData.width,y:messageData.height};on(event,{iframe:messageData.iframe,screenX:Number(data.x),screenY:Number(data.y),type:messageData.type})}function on(funcName,val){return chkEvent(iframeId,funcName,val)}var hashData,id,msgBody,data,height,iframe,compStyle,msg=event.data,messageData={},iframeId=null;if("[iFrameResizerChild]Ready"===msg)!function(){for(var iframeId in settings)trigger("iFrame requested init",createOutgoingMsg(iframeId),settings[iframeId].iframe,iframeId)}();else if(msgId===(""+msg).substr(0,msgIdLen)&&msg.substr(msgIdLen).split(":")[0]in settings){if(height=(data=msg.substr(msgIdLen).split(":"))[1]?parseInt(data[1],10):0,iframe=settings[data[0]]&&settings[data[0]].iframe,compStyle=getComputedStyle(iframe),messageData={iframe:iframe,id:data[0],height:height+function(compStyle){return"border-box"!==compStyle.boxSizing?0:(compStyle.paddingTop?parseInt(compStyle.paddingTop,10):0)+(compStyle.paddingBottom?parseInt(compStyle.paddingBottom,10):0)}(compStyle)+function(compStyle){return"border-box"!==compStyle.boxSizing?0:(compStyle.borderTopWidth?parseInt(compStyle.borderTopWidth,10):0)+(compStyle.borderBottomWidth?parseInt(compStyle.borderBottomWidth,10):0)}(compStyle),width:data[2],type:data[3]},iframeId=messageData.id,settings[iframeId]&&(settings[iframeId].loaded=!0),(iframe=messageData.type in{true:1,false:1,undefined:1})&&log(iframeId,"Ignoring init message from meta parent page"),!iframe&&function(iframeId){var retBool=!0;return settings[iframeId]||(retBool=!1,warn(messageData.type+" No settings for "+iframeId+". Message was: "+msg)),retBool}(iframeId)&&(log(iframeId,"Received: "+msg),iframe=!0,null===messageData.iframe&&(warn(iframeId,"IFrame ("+messageData.id+") not found"),iframe=!1),iframe)&&function(){var origin=event.origin,checkOrigin=settings[iframeId]&&settings[iframeId].checkOrigin;if(checkOrigin&&""+origin!="null"&&!function(){if(checkOrigin.constructor!==Array)return remoteHost=settings[iframeId]&&settings[iframeId].remoteHost,log(iframeId,"Checking connection is from: "+remoteHost),origin===remoteHost;var remoteHost,i=0,retCode=!1;for(log(iframeId,"Checking connection is from allowed list of origins: "+checkOrigin);i<checkOrigin.length;i++)if(checkOrigin[i]===origin){retCode=!0;break}return retCode}())throw new Error("Unexpected message received from: "+origin+" for "+messageData.iframe.id+". Message was: "+event.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return 1}()){switch(settings[iframeId]&&settings[iframeId].firstRun&&settings[iframeId]&&(settings[iframeId].firstRun=!1),messageData.type){case"close":closeIFrame(messageData.iframe);break;case"message":msgBody=getMsgBody(6),log(iframeId,"onMessage passed: {iframe: "+messageData.iframe.id+", message: "+msgBody+"}"),on("onMessage",{iframe:messageData.iframe,message:JSON.parse(msgBody)}),log(iframeId,"--");break;case"mouseenter":onMouse("onMouseEnter");break;case"mouseleave":onMouse("onMouseLeave");break;case"autoResize":settings[iframeId].autoResize=JSON.parse(getMsgBody(9));break;case"scrollTo":scrollRequestFromChild(!1);break;case"scrollToOffset":scrollRequestFromChild(!0);break;case"pageInfo":sendPageInfoToIframe(settings[iframeId]&&settings[iframeId].iframe,iframeId),id=iframeId,setListener("Add ",addEventListener),settings[id]&&(settings[id].stopPageInfo=stop);break;case"pageInfoStop":settings[iframeId]&&settings[iframeId].stopPageInfo&&(settings[iframeId].stopPageInfo(),delete settings[iframeId].stopPageInfo);break;case"inPageLink":msgBody=(msgBody=getMsgBody(9)).split("#")[1]||"",hashData=decodeURIComponent(msgBody),(hashData=document.getElementById(hashData)||document.getElementsByName(hashData)[0])?(hashData=getElementPosition(hashData),log(iframeId,"Moving to in page link (#"+msgBody+") at x: "+hashData.x+" y: "+hashData.y),pagePosition={x:hashData.x,y:hashData.y},scrollTo(),log(iframeId,"--")):window.top!==window.self?window.parentIFrame?window.parentIFrame.moveToAnchor(msgBody):log(iframeId,"In page link #"+msgBody+" not found and window.parentIFrame not found"):log(iframeId,"In page link #"+msgBody+" not found");break;case"reset":resetIFrame(messageData);break;case"init":resizeIFrame(),on("onInit",messageData.iframe);break;default:0===Number(messageData.width)&&0===Number(messageData.height)?warn("Unsupported message received ("+messageData.type+"), this is likely due to the iframe containing a later version of iframe-resizer than the parent page"):resizeIFrame()}function setListener(type,func){function sendPageInfo(){settings[id]?sendPageInfoToIframe(settings[id].iframe,id):stop()}["scroll","resize"].forEach(function(evt){log(id,type+evt+" listener for sendPageInfo"),func(window,evt,sendPageInfo)})}function stop(){setListener("Remove ",removeEventListener)}}}else!function(iframeId,msg){output("info",iframeId,msg,isLogEnabled(iframeId))}(iframeId,"Ignored: "+msg)}function chkEvent(iframeId,funcName,val){var func=null,retVal=null;if(settings[iframeId]){if("function"!=typeof(func=settings[iframeId][funcName]))throw new TypeError(funcName+" on iFrame["+iframeId+"] is not a function");retVal=func(val)}return retVal}function removeIframeListeners(iframe){iframe=iframe.id,delete settings[iframe]}function closeIFrame(iframe){var iframeId=iframe.id;if(!1===chkEvent(iframeId,"onClose",iframeId))log(iframeId,"Close iframe cancelled by onClose event");else{log(iframeId,"Removing iFrame: "+iframeId);try{iframe.parentNode&&iframe.parentNode.removeChild(iframe)}catch(error){warn(error)}chkEvent(iframeId,"onClosed",iframeId),log(iframeId,"--"),removeIframeListeners(iframe)}}function getPagePosition(iframeId){null===pagePosition&&log(iframeId,"Get page position: "+(pagePosition={x:window.pageXOffset!==undefined?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==undefined?window.pageYOffset:document.documentElement.scrollTop}).x+","+pagePosition.y)}function setPagePosition(iframeId){null!==pagePosition&&(window.scrollTo(pagePosition.x,pagePosition.y),log(iframeId,"Set page position: "+pagePosition.x+","+pagePosition.y),unsetPagePosition())}function unsetPagePosition(){pagePosition=null}function resetIFrame(messageData){log(messageData.id,"Size reset requested by "+("init"===messageData.type?"host page":"iFrame")),getPagePosition(messageData.id),syncResize(function(){setSize(messageData),trigger("reset","reset",messageData.iframe,messageData.id)},messageData,"reset")}function setSize(messageData){function processDimension(dimension){!function(dimension){messageData.id?(messageData.iframe.style[dimension]=messageData[dimension]+"px",log(messageData.id,"IFrame ("+iframeId+") "+dimension+" set to "+messageData[dimension]+"px")):log("undefined","messageData id not set")}(dimension),function(dimension){var target;function checkIFrames(){Object.keys(settings).forEach(function(key){function chkDimension(dimension){return"0px"===(settings[settingId]&&settings[settingId].iframe.style[dimension])}var settingId;settings[settingId=key]&&null!==settings[settingId].iframe.offsetParent&&(chkDimension("height")||chkDimension("width"))&&trigger("Visibility change","resize",settings[settingId].iframe,settingId)})}!hiddenCheckEnabled&&"0"===messageData[dimension]&&(hiddenCheckEnabled=!0,log(iframeId,"Hidden iFrame detected, creating visibility listener"),dimension=getMutationObserver())&&(target=document.querySelector("body"),new dimension(function(mutations){log("window","Mutation observed: "+mutations[0].target+" "+mutations[0].type),debounce(checkIFrames,16)}).observe(target,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0}))}(dimension)}var iframeId=messageData.iframe.id;settings[iframeId]&&(settings[iframeId].sizeHeight&&processDimension("height"),settings[iframeId].sizeWidth)&&processDimension("width")}function syncResize(func,messageData,doNotSync){doNotSync!==messageData.type&&requestAnimationFrame?(log(messageData.id,"Requesting animation frame"),requestAnimationFrame(func)):func()}function trigger(calleeMsg,msg,iframe,id,noResponseWarning){var target,errorShown=!1;id=id||iframe.id,settings[id]&&(iframe&&"contentWindow"in iframe&&null!==iframe.contentWindow?(target=settings[id]&&settings[id].targetOrigin,log(id,"["+calleeMsg+"] Sending msg to iframe["+id+"] ("+msg+") targetOrigin: "+target),iframe.contentWindow.postMessage(msgId+msg,target)):warn(id,"["+calleeMsg+"] IFrame("+id+") not found"),noResponseWarning)&&settings[id]&&settings[id].warningTimeout&&(settings[id].msgTimeout=setTimeout(function(){!settings[id]||settings[id].loaded||errorShown||(errorShown=!0,warn(id,"IFrame has not responded within "+settings[id].warningTimeout/1e3+" seconds. Check iFrameResizer.contentWindow.js has been loaded in iFrame. This message can be ignored if everything is working, or you can set the warningTimeout option to a higher value or zero to suppress this warning."))},settings[id].warningTimeout))}function createOutgoingMsg(iframeId){return iframeId+":"+settings[iframeId].bodyMarginV1+":"+settings[iframeId].sizeWidth+":"+settings[iframeId].log+":"+settings[iframeId].interval+":"+settings[iframeId].enablePublicMethods+":"+settings[iframeId].autoResize+":"+settings[iframeId].bodyMargin+":"+settings[iframeId].heightCalculationMethod+":"+settings[iframeId].bodyBackground+":"+settings[iframeId].bodyPadding+":"+settings[iframeId].tolerance+":"+settings[iframeId].inPageLinks+":"+settings[iframeId].resizeFrom+":"+settings[iframeId].widthCalculationMethod+":"+settings[iframeId].mouseEvents}function debounce(fn,time){null===timer&&(timer=setTimeout(function(){timer=null,fn()},time))}function tabVisible(){"hidden"!==document.visibilityState&&(log("document","Trigger event: Visiblity change"),debounce(function(){sendTriggerMsg("Tab Visible","resize")},16))}function sendTriggerMsg(eventName,event){Object.keys(settings).forEach(function(iframeId){!function(iframeId){return settings[iframeId]&&"parent"===settings[iframeId].resizeFrom&&settings[iframeId].autoResize&&!settings[iframeId].firstRun}(iframeId)||trigger(eventName,event,settings[iframeId].iframe,iframeId)})}function factory(){function init(options,element){if(element){if(!element.tagName)throw new TypeError("Object is not a valid DOM element");if("IFRAME"!==element.tagName.toUpperCase())throw new TypeError("Expected <IFRAME> tag, found <"+element.tagName+">");(function(iframe,options){function depricate(key){var splitName=key.split("Callback");2===splitName.length&&(this[splitName="on"+splitName[0].charAt(0).toUpperCase()+splitName[0].slice(1)]=this[key],delete this[key],warn(iframeId,"Deprecated: '"+key+"' has been renamed '"+splitName+"'. The old method will be removed in the next major version."))}var msg,MutationObserver,iframeId=function(iframeId){var id;return""===iframeId&&(iframe.id=(id=options&&options.id||defaults.id+count++,null!==document.getElementById(id)&&(id+=count++),iframeId=id),logEnabled=(options||{}).log,log(iframeId,"Added missing iframe ID: "+iframeId+" ("+iframe.src+")")),iframeId}(iframe.id);if(!(iframeId in settings&&"iFrameResizer"in iframe)){switch(function(options){options=options||{},settings[iframeId]={firstRun:!0,iframe:iframe,remoteHost:iframe.src&&iframe.src.split("/").slice(0,3).join("/")},function(options){if("object"!=typeof options)throw new TypeError("Options is not an object")}(options),Object.keys(options).forEach(depricate,options),function(options){for(var option in defaults)Object.prototype.hasOwnProperty.call(defaults,option)&&(settings[iframeId][option]=(Object.prototype.hasOwnProperty.call(options,option)?options:defaults)[option])}(options),settings[iframeId]&&(settings[iframeId].targetOrigin=!0!==settings[iframeId].checkOrigin||""===(options=settings[iframeId].remoteHost)||null!==options.match(/^(about:blank|javascript:|file:\/\/)/)?"*":options)}(options),log(iframeId,"IFrame scrolling "+(settings[iframeId]&&settings[iframeId].scrolling?"enabled":"disabled")+" for "+iframeId),iframe.style.overflow=!1===(settings[iframeId]&&settings[iframeId].scrolling)?"hidden":"auto",settings[iframeId]&&settings[iframeId].scrolling){case"omit":break;case!0:iframe.scrolling="yes";break;case!1:iframe.scrolling="no";break;default:iframe.scrolling=settings[iframeId]?settings[iframeId].scrolling:"no"}chkMinMax("Height"),chkMinMax("Width"),addStyle("maxHeight"),addStyle("minHeight"),addStyle("maxWidth"),addStyle("minWidth"),"number"!=typeof(settings[iframeId]&&settings[iframeId].bodyMargin)&&"0"!==(settings[iframeId]&&settings[iframeId].bodyMargin)||(settings[iframeId].bodyMarginV1=settings[iframeId].bodyMargin,settings[iframeId].bodyMargin=settings[iframeId].bodyMargin+"px"),msg=createOutgoingMsg(iframeId),(MutationObserver=getMutationObserver())&&function(MutationObserver){iframe.parentNode&&new MutationObserver(function(mutations){mutations.forEach(function(mutation){Array.prototype.slice.call(mutation.removedNodes).forEach(function(removedNode){removedNode===iframe&&closeIFrame(iframe)})})}).observe(iframe.parentNode,{childList:!0})}(MutationObserver),addEventListener(iframe,"load",function(){var firstRun,resetRequertMethod;trigger("iFrame.onload",msg,iframe,undefined,!0),firstRun=settings[iframeId]&&settings[iframeId].firstRun,resetRequertMethod=settings[iframeId]&&settings[iframeId].heightCalculationMethod in resetRequiredMethods,!firstRun&&resetRequertMethod&&resetIFrame({iframe:iframe,height:0,width:0,type:"init"})}),trigger("init",msg,iframe,undefined,!0),settings[iframeId]&&(settings[iframeId].iframe.iFrameResizer={close:closeIFrame.bind(null,settings[iframeId].iframe),removeListeners:removeIframeListeners.bind(null,settings[iframeId].iframe),resize:trigger.bind(null,"Window resize","resize",settings[iframeId].iframe),moveToAnchor:function(anchor){trigger("Move to anchor","moveToAnchor:"+anchor,settings[iframeId].iframe,iframeId)},sendMessage:function(message){trigger("Send Message","message:"+(message=JSON.stringify(message)),settings[iframeId].iframe,iframeId)}})}function addStyle(style){var styleValue=settings[iframeId][style];1/0!==styleValue&&0!==styleValue&&(iframe.style[style]="number"==typeof styleValue?styleValue+"px":styleValue,log(iframeId,"Set "+style+" = "+iframe.style[style]))}function chkMinMax(dimension){if(settings[iframeId]["min"+dimension]>settings[iframeId]["max"+dimension])throw new Error("Value for min"+dimension+" can not be greater than max"+dimension)}})(element,options),iFrames.push(element)}}var iFrames;return window.requestAnimationFrame?requestAnimationFrame=requestAnimationFrame.bind(window):log("setup","RequestAnimationFrame not supported"),addEventListener(window,"message",iFrameListener),addEventListener(window,"resize",function(){log("window","Trigger event: resize"),debounce(function(){sendTriggerMsg("Window resize","resize")},16)}),addEventListener(document,"visibilitychange",tabVisible),function(options,target){switch(iFrames=[],function(options){options&&options.enablePublicMethods&&warn("enablePublicMethods option has been removed, public methods are now always available in the iFrame")}(options),typeof target){case"undefined":case"string":Array.prototype.forEach.call(document.querySelectorAll(target||"iframe"),init.bind(undefined,options));break;case"object":init(options,target);break;default:throw new TypeError("Unexpected data type ("+typeof target+")")}return iFrames}}"undefined"!=typeof window&&(count=0,hiddenCheckEnabled=logEnabled=!1,msgHeaderLen="message".length,msgIdLen=(msgId="[iFrameSizer]").length,pagePosition=null,requestAnimationFrame=window.requestAnimationFrame,defaults={autoResize:!(timer=null),bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!(settings={}),enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!(resetRequiredMethods={max:1,scroll:1,bodyScroll:1,documentElementScroll:1}),maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,mouseEvents:!0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,warningTimeout:5e3,tolerance:0,widthCalculationMethod:"scroll",onClose:function(){return!0},onClosed:function(){},onInit:function(){},onMessage:function(){warn("onMessage function not defined")},onMouseEnter:function(){},onMouseLeave:function(){},onResized:function(){},onScroll:function(){return!0}},frameTimer={},"function"==typeof define&&define.amd?define([],factory):"object"==typeof module&&"object"==typeof module.exports&&(module.exports=factory()),window.iFrameResize=window.iFrameResize||factory())}();