!function(){const jobs=document.getElementById("jobstats");if(jobs){const REFRESH_INTERVAL=5e3,sorter=new Tablesort(jobs,{descending:!0}),progressx=window.progressx,theme=window.theme;let refreshIntervalId=null,oldRowsMap=new Map;async function fetchJobs(){try{var response=await fetch("/jobs");if(!response.ok)throw new Error("Fetch failed");var text=await response.text(),jobsResponse=(new DOMParser).parseFromString(text,"text/html").getElementById("jobstats");if(jobsResponse){const oldTbody=jobs.querySelector("#statCount"),newTbody=jobsResponse.querySelector("#statCount");oldTbody&&newTbody&&(0===oldRowsMap.size&&Array.from(oldTbody.rows).forEach(row=>{var name=row.cells[0]?.textContent.trim();name&&oldRowsMap.set(name,row)}),progressx.show(theme),requestAnimationFrame(()=>{var newRows=Array.from(newTbody.rows);const fragment=document.createDocumentFragment(),updatedRows=[];newRows.forEach(newRow=>{var jobName=newRow.cells[0]?.textContent.trim();if(jobName){var oldRow=oldRowsMap.get(jobName);if(oldRow){const oldCells=Array.from(oldRow.cells);var newCells=Array.from(newRow.cells);let changed=!1;newCells.forEach((newCell,j)=>{var oldSpan,newSpan;(j=oldCells[j])&&(oldSpan=j.querySelector("span"),newSpan=newCell.querySelector("span"),(oldSpan||j).textContent.trim()!==(newSpan||newCell).textContent.trim())&&(j.innerHTML=newCell.innerHTML,j.classList.add("updated"),changed=!0)}),changed&&(oldRowsMap.set(jobName,oldRow),updatedRows.push(oldRow),setTimeout(()=>{oldCells.forEach(cell=>cell.classList.remove("updated"))},REFRESH_INTERVAL-500))}else fragment.appendChild(newRow),oldRowsMap.set(jobName,newRow)}}),fragment.hasChildNodes()&&oldTbody.appendChild(fragment),updatedRows.forEach(row=>{var jobName=row.cells[0]?.textContent.trim();jobName&&oldRowsMap.set(jobName,row)}),sorter.refresh(),setTimeout(()=>progressx.hide(),500)}))}}catch(e){progressx.hide()}}function startRefresh(){refreshIntervalId||(fetchJobs(),refreshIntervalId=setInterval(fetchJobs,REFRESH_INTERVAL))}jobs.addEventListener("beforeSort",()=>{progressx.show(theme),progressx.progress(.5)}),jobs.addEventListener("afterSort",()=>{setTimeout(()=>progressx.hide(),500)}),"visible"===document.visibilityState&&startRefresh(),document.addEventListener("visibilitychange",()=>{"visible"===document.visibilityState?startRefresh():refreshIntervalId&&(clearInterval(refreshIntervalId),refreshIntervalId=null)}),requestAnimationFrame(()=>sorter.refresh())}}();