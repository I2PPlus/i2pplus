"use strict";var doc=document,DOCUMENT_FRAGMENT_NODE=11,ELEMENT_NODE=1,TEXT_NODE=3,COMMENT_NODE=8,NS_XHTML="http://www.w3.org/1999/xhtml";function defaultGetNodeKey(node){return node&&(node.getAttribute&&node.getAttribute("id")||node.id)}function compareNodeNames(fromEl,toEl){var fromCodeStart,toCodeStart;return(fromEl=fromEl.nodeName)===(toEl=toEl.nodeName)||(fromCodeStart=fromEl.charCodeAt(0),toCodeStart=toEl.charCodeAt(0),fromCodeStart<=90&&97<=toCodeStart?fromEl===toEl.toUpperCase():toCodeStart<=90&&97<=fromCodeStart&&toEl===fromEl.toUpperCase())}function createElementNS(name,namespaceURI){return namespaceURI&&namespaceURI!==NS_XHTML?doc.createElementNS(namespaceURI,name):doc.createElement(name)}function moveChildren(fromEl,toEl){for(;fromEl.firstChild;)toEl.appendChild(fromEl.firstChild);return toEl}function syncBooleanAttrProp(fromEl,toEl,name){fromEl[name]!==toEl[name]&&(fromEl[name]=toEl[name],fromEl[name]?fromEl.setAttribute(name,""):fromEl.removeAttribute(name))}var specialElHandlers={TEXTAREA:function(fromEl,toEl){fromEl.value!==toEl.value&&(fromEl.value=toEl.value),(fromEl=fromEl.firstChild)&&fromEl.nodeValue!==toEl.value&&(fromEl.nodeValue=toEl.value)},SELECT:function(fromEl,toEl){if(!toEl.hasAttribute("multiple")){for(var curChild=fromEl.firstChild,i=0,selected=-1;curChild;){if("OPTION"===curChild.nodeName&&curChild.hasAttribute("selected")){selected=i;break}curChild=curChild.nextSibling,i++}fromEl.selectedIndex=selected}},INPUT:function(fromEl,toEl){syncBooleanAttrProp(fromEl,toEl,"checked"),syncBooleanAttrProp(fromEl,toEl,"disabled"),fromEl.value!==toEl.value&&(fromEl.value=toEl.value),toEl.hasAttribute("value")||fromEl.removeAttribute("value")}};function morphAttrs(fromNode,toNode){for(var attr,attrName,attrNamespaceURI,attrValue,toNodeAttrs=toNode.attributes,i=toNodeAttrs.length-1;0<=i;i--)attrName=(attr=toNodeAttrs[i]).name,attrNamespaceURI=attr.namespaceURI,attrValue=attr.value,attrNamespaceURI?(attrName=attr.localName||attrName,fromNode.setAttributeNS(attrNamespaceURI,attrName,attrValue)):fromNode.setAttribute(attrName,attrValue);for(var fromNodeAttrs=fromNode.attributes,d=fromNodeAttrs.length-1;0<=d;d--)attrName=(attr=fromNodeAttrs[d]).name,(attrNamespaceURI=attr.namespaceURI)?(attrName=attr.localName||attrName,toNode.hasAttributeNS(attrNamespaceURI,attrName)||fromNode.removeAttributeNS(attrNamespaceURI,attrName)):toNode.hasAttribute(attrName)||fromNode.removeAttribute(attrName)}function morphdomFactory(morphAttrs){return function(fromNode,toNode,options){options=options||{},"string"==typeof toNode?(toNodeHtml=toNode,(toNode=doc.createElement("html")).innerHTML=toNodeHtml,toNode=toNode.firstChild):toNode.nodeType===DOCUMENT_FRAGMENT_NODE&&(toNode=toNode.firstElementChild);var getNodeKey=options.getNodeKey||defaultGetNodeKey,onBeforeNodeAdded=options.onBeforeNodeAdded||function(){},onNodeAdded=options.onNodeAdded||function(){},onBeforeElUpdated=options.onBeforeElUpdated||function(){},onElUpdated=options.onElUpdated||function(){},onBeforeNodeDiscarded=options.onBeforeNodeDiscarded||function(){},onNodeDiscarded=options.onNodeDiscarded||function(){},onBeforeElChildrenUpdated=options.onBeforeElChildrenUpdated||function(){},skipFromChildren=options.skipFromChildren||function(){},addChild=options.addChild||function(parent,child){return parent.appendChild(child)},toNodeHtml=!0===options.childrenOnly,fromNodesLookup=Object.create(null),keyedRemovalList=[];function addKeyedRemoval(key){keyedRemovalList.push(key)}function removeNode(node,parentNode,skipKeyedNodes){!1!==onBeforeNodeDiscarded(node)&&(parentNode&&parentNode.removeChild(node),onNodeDiscarded(node),function walkDiscardedChildNodes(node,skipKeyedNodes){if(node.nodeType===ELEMENT_NODE)for(var curChild=node.firstChild;curChild;){var key=getNodeKey(curChild);skipKeyedNodes&&key?addKeyedRemoval(key):(onNodeDiscarded(curChild),curChild.firstChild&&walkDiscardedChildNodes(curChild,skipKeyedNodes)),curChild=curChild.nextSibling}}(node,skipKeyedNodes))}function indexTree(node){if(node.nodeType===ELEMENT_NODE||node.nodeType===DOCUMENT_FRAGMENT_NODE)for(var curChild=node.firstChild;curChild;){var key=getNodeKey(curChild);key&&(fromNodesLookup[key]=curChild),indexTree(curChild),curChild=curChild.nextSibling}}indexTree(fromNode);var morphedNodeType=(options=fromNode).nodeType,toNodeType=toNode.nodeType;if(!toNodeHtml)if(morphedNodeType===ELEMENT_NODE)toNodeType!==ELEMENT_NODE||compareNodeNames(fromNode,toNode)||(onBeforeNodeDiscarded(fromNode),onNodeDiscarded(fromNode),options=moveChildren(fromNode,createElementNS(toNode.nodeName,toNode.namespaceURI)));else if(morphedNodeType===TEXT_NODE||morphedNodeType===COMMENT_NODE){if(toNodeType===morphedNodeType&&options.nodeValue!==toNode.nodeValue)return options.nodeValue=toNode.nodeValue,options;options=toNode}if(options===toNode)onNodeDiscarded(fromNode);else{if(toNode.isSameNode&&toNode.isSameNode(options))return;if(function morphEl(fromEl,toEl,childrenOnly){var toElKey=getNodeKey(toEl);if(toElKey&&delete fromNodesLookup[toElKey],!childrenOnly){if(!1===(toElKey=onBeforeElUpdated(fromEl,toEl)))return;if(toElKey instanceof HTMLElement&&indexTree(fromEl=toElKey),morphAttrs(fromEl,toEl),onElUpdated(fromEl),!1===onBeforeElChildrenUpdated(fromEl,toEl))return}"TEXTAREA"!==fromEl.nodeName?function(fromEl,toEl){var skipFrom=skipFromChildren(fromEl,toEl),curToNodeChild=toEl.firstChild,curFromNodeChild=fromEl.firstChild;outer:for(;curToNodeChild;){for(var onBeforeNodeAddedResult,toNextSibling=curToNodeChild.nextSibling,curToNodeKey=getNodeKey(curToNodeChild);!skipFrom&&curFromNodeChild;){var matchingFromEl,fromNextSibling=curFromNodeChild.nextSibling,curFromNodeKey=getNodeKey(curFromNodeChild),curFromNodeType=curFromNodeChild.nodeType,isCompatible=void 0;if(curFromNodeType===curToNodeChild.nodeType&&(curFromNodeType===ELEMENT_NODE?(curToNodeKey?curToNodeKey!==curFromNodeKey&&((matchingFromEl=fromNodesLookup[curToNodeKey])&&compareNodeNames(curFromNodeChild,matchingFromEl)?(fromEl.insertBefore(matchingFromEl,curFromNodeChild),curFromNodeKey?addKeyedRemoval(curFromNodeKey):removeNode(curFromNodeChild,fromEl,!0),curFromNodeKey=getNodeKey(curFromNodeChild=matchingFromEl)):isCompatible=!1):curFromNodeKey&&(isCompatible=!1),(isCompatible=!1!==isCompatible&&compareNodeNames(curFromNodeChild,curToNodeChild))&&morphEl(curFromNodeChild,curToNodeChild)):curFromNodeType!==TEXT_NODE&&curFromNodeType!==COMMENT_NODE||curFromNodeChild.nodeValue!==curToNodeChild.nodeValue&&(curFromNodeChild.nodeValue=curToNodeChild.nodeValue)),isCompatible){curToNodeChild=toNextSibling,curFromNodeChild=fromNextSibling;continue outer}curFromNodeKey?addKeyedRemoval(curFromNodeKey):removeNode(curFromNodeChild,fromEl,!0),curFromNodeChild=fromNextSibling}curToNodeKey&&fromNodesLookup[curToNodeKey]&&compareNodeNames(fromNodesLookup[curToNodeKey],curToNodeChild)?(matchingFromEl=fromNodesLookup[curToNodeKey],skipFrom||addChild(fromEl,matchingFromEl),morphEl(matchingFromEl,curToNodeChild)):!1!==(onBeforeNodeAddedResult=onBeforeNodeAdded(curToNodeChild))&&((curToNodeChild=onBeforeNodeAddedResult||curToNodeChild).actualize&&(curToNodeChild=curToNodeChild.actualize(doc)),addChild(fromEl,curToNodeChild),function handleNodeAdded(el){onNodeAdded(el);for(var curChild=el.firstChild;curChild;){var key=getNodeKey(curChild);(key=key&&fromNodesLookup[key])&&compareNodeNames(curChild,key)?(curChild.parentNode.replaceChild(key,curChild),morphEl(key,curChild)):handleNodeAdded(curChild),curChild=curChild.nextSibling}}(curToNodeChild)),curToNodeChild=toNextSibling,curFromNodeChild=fromNextSibling}!function(fromEl,curFromNodeChild){for(;curFromNodeChild;){var fromNextSibling=curFromNodeChild.nextSibling,curFromNodeKey=getNodeKey(curFromNodeChild);curFromNodeKey?addKeyedRemoval(curFromNodeKey):removeNode(curFromNodeChild,fromEl,!0),curFromNodeChild=fromNextSibling}}(fromEl,curFromNodeChild)}(fromEl,toEl):specialElHandlers.TEXTAREA(fromEl,toEl)}(options,toNode,toNodeHtml),keyedRemovalList.length)for(var i=0,len=keyedRemovalList.length;i<len;i++){var elToRemove=fromNodesLookup[keyedRemovalList[i]];elToRemove&&removeNode(elToRemove,elToRemove.parentNode,!1)}}return!toNodeHtml&&options!==fromNode&&fromNode.parentNode&&(options.actualize&&(options=options.actualize(doc)),fromNode.parentNode.replaceChild(options,fromNode)),options}}export default morphdomFactory(morphAttrs);