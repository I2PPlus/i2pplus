import{refreshElements}from"/js/refreshElements.js";!function(){const ntcpConn=document.getElementById("ntcpconnections"),ntcpTfoot=(document.getElementById("ntcpcon"),document.querySelector("#ntcpconnections tfoot")),peersNTCP=document.getElementById("peersNTCP"),peersSSU=document.getElementById("peersSSU"),ssuConn=document.getElementById("udpconnections"),ssuTfoot=(document.getElementById("udpcon"),document.querySelector("#udpconnections tfoot"));var summary=document.getElementById("transportSummary"),url=document.location;const path=location.pathname,query=location.search,queryParams=new URL(url.href).searchParams,REFRESH_INTERVAL=summary?5e3:1e4;let sorterNTCP,sorterSSU;function countTiers(){var tierL,tierM,tierN,tierO,tierP,tierX,isFF,isU,topCount;(ssuTfoot||ntcpTfoot)&&(tierL=document.querySelectorAll(".rbw.L"),tierM=document.querySelectorAll(".rbw.M"),tierN=document.querySelectorAll(".rbw.N"),tierO=document.querySelectorAll(".rbw.O"),tierP=document.querySelectorAll(".rbw.P"),tierX=document.querySelectorAll(".rbw.X"),isFF=document.querySelectorAll(".isff"),isU=document.querySelectorAll(".isU"),tierL=tierL.length,tierM=tierM.length,tierN=tierN.length,tierO=tierO.length,tierP=tierP.length,tierX=tierX.length,isFF=isFF.length,isU=isU.length,topCount=document.getElementById("topCount"))&&(topCount.innerHTML="<table><tr>"+(0<tierL?"<td class=rbw>L<span> "+tierL+"</span></td>":"")+(0<tierM?"<td class=rbw>M<span> "+tierM+"</span></td>":"")+(0<tierN?"<td class=rbw>N<span> "+tierN+"</span></td>":"")+(0<tierO?"<td class=rbw>O<span> "+tierO+"</span></td>":"")+(0<tierP?"<td class=rbw>P<span> "+tierP+"</span></td>":"")+(0<tierX?"<td class=rbw>X<span> "+tierX+"</span></td>":"")+(0<isU?"<td class=rbw id=u>U<span> "+isU+"</span></td>":"")+(0<isFF?"<td class=rbw id=ff>F<span> "+isFF+"</span></td>":"")+"</tr></table>")}function setupRefresh(selector){var fetchUrl=queryParams.has("transport")?path+query:"/peers";refreshElements(selector,fetchUrl,REFRESH_INTERVAL)}peersNTCP&&void 0===sorterNTCP&&(sorterNTCP=new Tablesort(ntcpConn,{descending:!0})),peersSSU&&void 0===sorterSSU&&(sorterSSU=new Tablesort(ssuConn,{descending:!0})),progressx.hide(),document.addEventListener("DOMContentLoaded",()=>{ntcpConn&&(ntcpConn.addEventListener("beforeSort",function(){progressx.show(theme),progressx.progress(.5)}),ntcpConn.addEventListener("afterSort",function(){progressx.hide()})),ssuConn&&(ssuConn.addEventListener("beforeSort",function(){progressx.show(theme),progressx.progress(.5)}),ssuConn.addEventListener("afterSort",function(){progressx.hide()})),countTiers(),peersNTCP&&setupRefresh("#peersNTCP, #ntcpcon, #ntcpconnections tfoot"),peersSSU&&setupRefresh("#peersSSU, #udpcon, #udpconnections tfoot"),document.addEventListener("refreshComplete",()=>{sorterNTCP?sorterNTCP.refresh():sorterSSU&&sorterSSU.refresh(),countTiers()})})}();