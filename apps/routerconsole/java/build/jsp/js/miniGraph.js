let refreshInterval=null!==refresh?Math.max(1e3*refresh,1e3):5e3,minigraphRefreshIntervalId,minigraphRefreshInterval=Math.min(3*refreshInterval/2-500,9500),lastRefreshTime=0;const isDocumentVisible=!document.hidden,offscreenCanvas=document.createElement("canvas"),worker=new SharedWorker("/js/fetchWorker.js");function miniGraph(){worker.port.start(),worker.port.addEventListener("message",handleWorkerMessage),worker.port.postMessage({type:"connect"})}function handleWorkerMessage(event){"connected"===event.data.type&&(minigraphRefreshIntervalId=minigraphRefreshIntervalId||setInterval(refreshGraph,refreshInterval)),event.data.responseBlob&&handleGraphUpdate(event.data.responseBlob)}async function refreshGraph(){var currentTime=Date.now();currentTime-lastRefreshTime>=refreshInterval&&(lastRefreshTime=currentTime,document.getElementById("minigraph"))&&worker.port.postMessage({url:"/viewstat.jsp?stat=bw.combined&periodCount=20&width=250&height=50&hideLegend=true&hideGrid=true&hideTitle=true&t="+Date.now()})}function handleGraphUpdate(responseBlob){const image=new Image;image.src=URL.createObjectURL(responseBlob),image.onload=()=>{var offscreenCtx,graphCanvas=document.getElementById("minigraph");graphCanvas&&(offscreenCtx=offscreenCanvas.getContext("2d"),offscreenCanvas.width=245,offscreenCanvas.height=50,offscreenCtx.clearRect(0,0,245,50),offscreenCtx.drawImage(image,0,0),offscreenCtx=graphCanvas.parentNode)&&(offscreenCtx.replaceChild(offscreenCanvas,graphCanvas),offscreenCanvas.id="minigraph")}}document.addEventListener("DOMContentLoaded",()=>{miniGraph(),refreshGraph(),minigraphRefreshIntervalId=setInterval(refreshGraph,refreshInterval)}),document.addEventListener("visibilitychange",()=>{isDocumentVisible?minigraphRefreshIntervalId=setInterval(refreshGraph,refreshInterval):clearInterval(minigraphRefreshIntervalId)});export{miniGraph};