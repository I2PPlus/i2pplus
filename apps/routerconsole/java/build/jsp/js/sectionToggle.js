import{stickySidebar}from"/js/stickySidebar.js";const sb=document.getElementById("sidebar");function sectionToggler(){const jobBadge=sb.querySelector('h3 a[href="/jobs"] .badge'),tunnelsBadge=sb.querySelector('h3 a[href="/tunnels"] .badge'),localtunnelSummary=document.getElementById("localtunnelSummary"),sb_advanced=document.getElementById("sb_advanced");var sb_advancedgeneral=document.getElementById("sb_advancedgeneral");const sb_bandwidth=document.getElementById("sb_bandwidth");var sb_general=document.getElementById("sb_general");const sb_graphstats=document.getElementById("sb_graphstats");var sb_help=document.getElementById("sb_help");const sb_internals=document.getElementById("sb_internals"),sb_localtunnels=document.getElementById("sb_localtunnels");document.getElementById("sb_newsH3");var sb_newsheadings=document.getElementById("sb_newsheadings"),sb_peers=document.getElementById("sb_peers"),sb_queue=(document.getElementById("sb_peers_condensed"),document.getElementById("sb_queue"));const sb_services=document.getElementById("sb_services");document.getElementById("sb_shortgeneral");var sb_tunnels=document.getElementById("sb_tunnels");document.getElementById("sb_tunnels_condensed");const sb_updatesection=document.getElementById("sb_updatesection"),sb_wrap=document.getElementById("sb_wrap")||sb,xhr=document.getElementById("xhr"),savedConfigs=localStorage.getItem("sidebarSections"),sidebarSections=(document.querySelector(".main"),null!==savedConfigs?JSON.parse(savedConfigs):null),toggleElements={toggle_sb_advancedgeneral:sb_advancedgeneral,toggle_sb_advanced:sb_advanced,toggle_sb_bandwidth:sb_bandwidth,toggle_sb_general:sb_general,toggle_sb_help:sb_help,toggle_sb_internals:sb_internals,toggle_sb_localtunnels:sb_localtunnels,toggle_sb_newsheadings:sb_newsheadings,toggle_sb_peers:sb_peers,toggle_sb_queue:sb_queue,toggle_sb_services:sb_services,toggle_sb_tunnels:sb_tunnels,toggle_sb_updatesection:sb_updatesection};function toggleElementVisibility(toggleInput,isVisible){var hr,element=toggleElements[toggleInput.id];element&&element.parentElement&&(element.parentElement.querySelector("h3"),element.parentElement.querySelector("a .badge"),element.hidden=!isVisible,hr=sb.querySelector(`#${element.id}+hr`),element===sb_updatesection?function(isVisible){var toggleInput;null!==sb_updatesection&&(sb_updatesection.hidden=!1,toggleInput=document.getElementById("toggle_sb_updatesection"),isVisible?(toggleInput.checked=!0,sb_updatesection.classList.remove("collapsed"),sb_updatesection.querySelector("h3").classList.remove("collapsed")):(toggleInput.checked=!1,sb_updatesection.classList.add("collapsed"),sb_updatesection.querySelector("h3").classList.add("collapsed")))}(isVisible):element===sb_services?function(isVisible){var hr,toggleInput,icons,textLinks;null!==sb_services&&(hr=sb.querySelector("#sb_services.collapsed+hr"),toggleInput=document.getElementById("toggle_sb_services"),icons=sb_services.querySelectorAll(".sb_icon"),textLinks=sb_services.querySelectorAll("a:not(.sb_icon)"),isVisible?(icons.forEach(icon=>{icon.hidden=!0}),textLinks.forEach(link=>{link.hidden=null}),toggleInput.checked=!0,sb_services.classList.remove("collapsed"),toggleInput.closest("h3").classList.remove("collapsed"),null!==hr&&(hr.hidden=null)):(icons.forEach(icon=>{icon.hidden=null}),textLinks.forEach(link=>{link.hidden=!0}),toggleInput.checked=!1,sb_services.classList.add("collapsed"),toggleInput.closest("h3").classList.add("collapsed"),null!==hr&&(hr.hidden=!0)))}(isVisible):isVisible?(hr&&(hr.hidden=!1,hr.style.display=null),toggleInput.checked=!0,element.classList&&element.classList.remove("collapsed")):(hr&&(hr.hidden=!0,hr.style.display="none"),toggleInput.checked=!1,element.classList&&element.classList.add("collapsed")),"toggle_sb_localtunnels"===toggleInput.id?function(isVisible){if(localtunnelSummary)if(isVisible)localtunnelSummary.hidden||(localtunnelSummary.hidden=!0);else{var container=sb_localtunnels,newCounts={};for(const key in iconTypes)newCounts[key]=container.querySelectorAll(`img[src='${iconTypes[key]}']`).length;if(cachedCounts&&Object.entries(newCounts).every(([key,val])=>cachedCounts[key]===val))localtunnelSummary.hidden&&(localtunnelSummary.hidden=!1);else if(cachedCounts=newCounts,isVisible=(isVisible=localtunnelSummary.querySelector("tr#localtunnelsActive"))&&isVisible.querySelector("td")){var type,count,span,img,fragment=document.createDocumentFragment();for([type,count]of Object.entries(newCounts))0!==count&&((span=document.createElement("span")).className="count_"+count,(img=document.createElement("img")).src=iconTypes[type],img.alt=type+" tunnel icon",span.appendChild(document.createTextNode(count+" x ")),span.appendChild(img),fragment.appendChild(span));isVisible.innerHTML="",isVisible.appendChild(fragment),localtunnelSummary.hidden&&(localtunnelSummary.hidden=!1)}}}(isVisible):"toggle_sb_queue"===toggleInput.id?function(isVisible){jobBadge&&(jobBadge.hidden=isVisible)}(isVisible):"toggle_sb_tunnels"===toggleInput.id&&function(isVisible){tunnelsBadge&&(tunnelsBadge.hidden=isVisible)}(isVisible),element===sb_bandwidth&&sb_graphstats&&(sb_graphstats.style.opacity=sb_bandwidth.hidden?"1":null),element!==sb_internals&&element!==sb_advanced||(hr.hidden=!1,hr.style.display=null))}const iconTypes={server:"/themes/console/images/server.svg",client:"/themes/console/images/client.svg",snark:"/themes/console/images/snark.svg",i2pchat:"/themes/console/images/i2pchat.svg",ping:"/themes/console/images/ping.svg"};let cachedCounts=null;!function(){var sidebarSections=JSON.parse(localStorage.getItem("sidebarSections"));sidebarSections&&Object.entries(sidebarSections).forEach(([id,checked])=>{if(id=document.getElementById("toggle_sb_"+id)){id.checked=checked,toggleElementVisibility(id,checked);var h3Element=id.closest("h3");const badge=id.parentElement.querySelector("a .badge");h3Element&&(checked?(h3Element.classList.remove("collapsed"),badge&&requestAnimationFrame(()=>{badge.hidden=!0})):(h3Element.classList.add("collapsed"),badge&&badge.removeAttribute("hidden")))}})}(),sb_wrap.addEventListener("click",event=>{var currentState;event.target.id in toggleElements&&(currentState=event.target.checked,toggleElementVisibility(event.target,currentState),async function(){var key,toggleInput=document.activeElement;toggleInput&&toggleInput.id.startsWith("toggle_sb_")&&(key=toggleInput.id.replace("toggle_sb_",""),savedConfigs||await new Promise(resolve=>{var defaultState={advancedgeneral:!1,advanced:!1,bandwidth:!1,general:!1,help:!1,internals:!1,localtunnels:!1,newsheadings:!1,peers:!1,queue:!1,services:!1,tunnels:!1,updatesection:!1};localStorage.setItem("sidebarSections",JSON.stringify(defaultState)),resolve(defaultState)}),sidebarSections[key]=toggleInput.checked,localStorage.setItem("sidebarSections",JSON.stringify(sidebarSections)))}(),stickySidebar())}),document.addEventListener("DOMContentLoaded",()=>{setTimeout(()=>{xhr.classList.remove("fadein")},120)})}function countNewsItems(){var sbNewsHeadings=document.getElementById("sb_newsheadings"),newsBadge=document.getElementById("newsCount"),doubleCount=sb.querySelector("#newsCount+#newsCount");sbNewsHeadings&&newsBadge&&(doubleCount&&doubleCount.remove(),doubleCount=sbNewsHeadings.querySelectorAll("table tr").length,newsBadge.hidden=doubleCount<=0||!sbNewsHeadings.classList.contains("collapsed"),0<doubleCount)&&newsBadge.innerHTML!==doubleCount.toString()&&(newsBadge.innerHTML=doubleCount)}export{sectionToggler,countNewsItems};