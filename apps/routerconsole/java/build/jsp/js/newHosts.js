function newHosts(){const newHostsBadge=document.getElementById("newHosts");if(newHostsBadge)if("dark"!==theme)newHostsBadge.style.display="none";else{var now,storedData,lastFetch;let tooltipInitialized=!1;function getStoredData(){var key="newHostsData",rawData=localStorage.getItem(key);if(!rawData)return{hostnames:[],count:0,lastUpdated:null};try{var parsed=JSON.parse(rawData);if("object"!=typeof parsed||Array.isArray(parsed)||null===parsed)throw new Error("Data is not an object");return parsed}catch(e){return console.warn("Invalid JSON in localStorage, clearing:",key),localStorage.removeItem(key),{hostnames:[],count:0,lastUpdated:null}}}function fetchNewHosts(){localStorage.setItem("newHostsLastFetch",Date.now()),fetch("/susidns/log.jsp").then(response=>response.text()).then(html=>{var html=(new DOMParser).parseFromString(html,"text/html"),now=new Date;const oneDayAgo=new Date(now.getTime()-864e5),hostnameMap=(now=Array.from(html.querySelectorAll("li")).flatMap(entry=>{var dateText=entry.querySelector(".date")?.textContent;if(!dateText)return[];const entryDate=new Date(dateText);return entryDate<oneDayAgo?[]:(dateText=entry.querySelectorAll("a"),Array.from(dateText).map(a=>({hostname:new URL(a.href).hostname,timestamp:entryDate.getTime()})))}),html=getStoredData().hostnames||[],new Map);[...html,...now].forEach(h=>{(!hostnameMap.has(h.hostname)||h.timestamp>hostnameMap.get(h.hostname)?.timestamp)&&hostnameMap.set(h.hostname,h)});var count=(now=(html=Array.from(hostnameMap.values()).filter(h=>h.timestamp>=oneDayAgo.getTime()).sort((a,b)=>b.timestamp-a.timestamp).slice(0,10)).map(h=>h.hostname).sort()).length;localStorage.setItem("newHostsData",JSON.stringify({count:count,lastUpdated:Date.now(),hostnames:html})),newHostsBadge.textContent=10<count?"10+":count||"",updateTooltip(now)}).catch(err=>console.error("Failed to fetch new hosts:",err))}function updateTooltip(hostnames){if(newHostsBadge){const newHosts=document.getElementById("newHostsList");var newHostsTd=newHosts?.querySelector("td");if(hostnames.length){if(hostnames=hostnames.map(hostname=>{var shortName=hostname.replace(".i2p","");return`<a href="http://${hostname}" target="_blank">${shortName}</a>`}).join("<br>"),newHostsTd&&(newHostsTd.innerHTML=hostnames),newHosts.hidden=!0,!tooltipInitialized){newHostsBadge.addEventListener("mouseenter",()=>{newHosts.hidden=!1,document.getElementById("sb_services")?.classList.add("tooltipped")},{passive:!0});const services=document.getElementById("sb_services");services?.addEventListener("mouseleave",()=>{newHosts.hidden=!0,services.classList.remove("tooltipped")},{passive:!0}),tooltipInitialized=!0}}else newHosts.hidden=!0,newHostsTd&&(newHostsTd.innerHTML="")}}now=Date.now(),storedData=getStoredData(),lastFetch=parseInt(localStorage.getItem("newHostsLastFetch")||"0"),storedData.lastUpdated&&now-storedData.lastUpdated<9e5&&now-lastFetch<6e5?({count:now,hostnames:lastFetch}=storedData,0<now?(newHostsBadge.textContent=10<now?"10+":now,updateTooltip(lastFetch.map(h=>h.hostname))):newHostsBadge.textContent=""):fetchNewHosts(),setInterval(fetchNewHosts,18e5)}}export{newHosts};